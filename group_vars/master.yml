---
mysql_root_password: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        63373465623138326232393736363535333263363130363361623630626637353939376565393933
        3061363361363261636463316432653666623538613734340a336330333439363330656535396261
        34363237623061646338313338316464613238303236386465386466356262373638396366383538
        6562346666343037660a353533383461663730386365343333326332303934306632623362386137
        66363733663335343730643434613266303337633663343237326336383031616336636130663762
        36363964613235396338366638623663663363323239343930633131356338303263373064363263
        326261313932313934326161366239613636

icinga2_web_db_password: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        65366631383863343964663432666638313037396339643435373531303537353037623061343433
        3161323437393066396438313464643863333536656539630a396532393031653161373937666137
        65393162383230653231346533326664323532626235356136616638363632393734356434623363
        6464313535613137380a393661363163633238653438616463626435396433376439373530633833
        38626265656530386666376338613366633865356366363938333564303933663163666337656334
        61396663613730323866313632326239633763396237623530336234353037303133373231353332
        326333666535343337343332323761366433
icinga2_web_apiuser_password: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        64656539613062343664656334353463313832653666396261643135316539376632373364373065
        3435366134313362366366363132373130373738353731330a343931313030613930313933386338
        33663835356237666637383666356130323165656337326633626163323263396436306134316161
        6536393830343135360a323032386562393062656666313664636631336439326463323261626464
        63626634363530393534636236353465346535636638393565633262373063663234313737343163
        39323333376135363964376466633565616439343062366361636566633331356636633436343539
        366562333639656437643839396562653437

mysql_databases:
  - name: "{{ icinga2_ido_dbname }}"
  - name: "icingaweb2db"
mysql_users:
  - name: "{{ icinga2_ido_user }}"
    host: "%"
    password: "{{ icinga2_ido_password }}"
    priv: "{{ icinga2_ido_dbname }}.*:ALL"
  - name: "icingaweb2"
    host: "%"
    password: "{{ icinga2_web_db_password }}"
    priv: "icingaweb2db.*:ALL"

#mysql_replication_role: 'master'
#mysql_replication_user:
#    name: replicator
#    host: "*"
#    priv: "*.*:ALL"
#    password: !vault |
#        $ANSIBLE_VAULT;1.1;AES256
#        61666530646366626164313530316364306335643533303332636634646539396461326635663539
#        3539623531316639643663343232636534666435653938300a663638383836623130333236393431
#        63393335666562313362646237396234626563353138633832636537386633633134353865343731
#        3036316461396361320a313539663631343065646237633838393939363162383532313437386638
#        34366263306338303336306264653363373439333063313733616334393938616135383833363137
#        32343634343036386533383762353038643630313963356332613131636135346138373166326139
#        306262333766313764333061373864656261

mysql_packages:
  - mariadb-client
  - mariadb-server
  - python-mysqldb
  - python3-mysqldb

icinga2_ido_password: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        63663430366665656666363839663134323763393766363839366638666536383665363635353861
        3337376538633164373738656133653362663965373764300a623535636131316433363332363438
        65323561323336633461316363623736376366333861386635653331323235376664636166653339
        6635363838303934330a346663366632356231353732313436366134663166396431323535623939
        36353738323531616235303161323235393234343130323961646635383633613632646238633136
        63303263366163653265366532656435383666333832636330393531323663383335653135366531
        336238393539346464613639363534396332
icinga2_ido_user: icinga2
icinga2_ido_dbname: icinga2ido
icinga2_ido_host: icinga-a.int.goe.de.n0emis.eu

icinga2_ca_host: "{{ icinga2_ido_host }}"

icinga2_enable_web: yes

icinga2_features: [ "ido-mysql", "checker", "api", "notification", "mainlog" ]

icinga2_zones:
  master:
    endpoints:
      - icinga-a.int.goe.de.n0emis.eu
      #- icinga-b.int.goe.de.n0emis.eu
  director-global:
    global: true
  global-templates:
    global: true

icinga2_endpoints:
  icinga-a.int.goe.de.n0emis.eu:
    host: icinga-a.int.goe.de.n0emis.eu
#  icinga-b.int.goe.de.n0emis.eu:
#    host: icinga-b.int.goe.de.n0emis.eu
icinga2_apiusers:
  icingaweb2:
    password: "{{ icinga2_web_apiuser_password }}"
    permissions:
      - "status/query"
      - "actions/*"
      - "objects/modify/*"
      - "objects/query/*"


packages_debian:
  - icinga2
  - icingacli
  - icingaweb2
  - monitoring-plugins
  - bash-completion
  - vim-icinga2
  - vim

nginx_vhost_template: "vhost.j2"
nginx_remove_default_vhost: true
nginx_user: www-data
nginx_vhosts:
  - listen: "80"  # Wiki
    server_name: "_"
    root: "/usr/share/icingaweb2/public"
    index: "index.php"
    state: "present"
    template: "{{ nginx_vhost_template }}"
    filename: "dokuwiki.conf"
    extra_parameters: |
        location ~ ^/icingaweb2/index\.php(.*)$ {
          fastcgi_pass 127.0.0.1:9000;
          fastcgi_index index.php;
          include fastcgi_params;
          fastcgi_param SCRIPT_FILENAME /usr/share/icingaweb2/public/index.php;
          fastcgi_param ICINGAWEB_CONFIGDIR /etc/icingaweb2;
          fastcgi_param REMOTE_USER $remote_user;
        }

        location ~ ^/icingaweb2(.+)? {
          alias /usr/share/icingaweb2/public;
          index index.php;
          try_files $1 $uri $uri/ /icingaweb2/index.php$is_args$args;
        }


php_webserver_daemon: nginx
php_enable_php_fpm: true
php_use_managed_ini: true
php_default_version_debian: "7.3"
